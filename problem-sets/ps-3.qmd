---
title: "Problem Set 3: Multiple and Logistic Regression"
author: "Your Name"
format:
  html: default
  pdf: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r packages, include=FALSE}
library(tidyverse)
library(openintro)
library(statsr)
library(broom)
library(dplyr)
library(readr)
library(readxl)
```

The National Health and Nutrition Examination Survey (NHANES) is a survey conducted annually by the US Centers for Disease Control and Prevention (CDC) involving about 10,000 Americans aged 21 and older. In this problem set, you will use a data set obtained by randomly sampling 500 cases from the 10,000 NHANES survey participants. This new data set is called **nhanes_samp_adult_500** and is available online at \url{https://www.openintro.org/data/csv/nhanes.samp.adult.500.csv}.

## Importing the Data

Up to this point in this course we have been using data frames that we either created in R or loaded from some package. In this problem set, you will use data from an online source. You will import this data in your workspace as a tibble. Tibbles are same as data frames but with several advantages such as

-   They load faster than data frames.

-   Allow use of non-standard variable names (i.e., variables can have sapces and can start with a number)

-   Allow you to have columns as lists.

To import the data set into your work space, use the command `read_csv()` which imports the data as a tibble. So you know, the command `read.csv()` loads data as a data frame. As noted earlier, the data is stored on a website and we have the link (URL). Use the command below to load the data into your workspace. Note that we are naming the data **nhanes_samp_adult_500**.

```{r, include=FALSE}
nhanes_samp_adult_500 <- read_csv("https://www.openintro.org/data/csv/nhanes.samp.adult.500.csv")
```

If you data loads properly, it is highly recommended that you take some time to study it so you understand its context and variables. Doing this will make your analyses easier and interpretations will be meaningful.

## Problem 1 (Linear Regression)

Several studies point out that maintaining a healthy weight is an important part of well being. The goal in this problem is to identify, via linear regression, the most important factors that can determine someone's weight. Here is a list of the variables you will consider in this problem:

**PhysActive**: A categorical variable coded as **Yes** if the participant does moderate or vigorous-intensity sports, fitness, or recreational activities, and **No** if otherwise.

**`Height`**: A numerical variable measuring height in cm.

**`SleepHrsNight`**: A numerical variable representing the average sleep time per night in hours.

**`AgeMonths`**: A numerical variable giving someone's age in months.

**`MaritalStatus`**: A categorical variable with levels Divorced, LivePartner, Married, NeverMarried, Separated, and Widowed.

**`Education`**: A categorical variable with levels 8th Grade 9 - 11th Grade, High School, Some College, and College Grad.

**`Gender`**: a categorical variable with levels female, male.

As we have learned in this course, having a lot of predictors does not necessarily mean you have a great model. You are going to start by fitting a model with all predictors listed above and then perform model selection (backward elimination) to come up with the ''best model'' for predicting weight.

a)  Create a model for predicting weight based on all variables in the list above. Based on this model, what factor has the most influence on weight? What factor has the least influence?

<!--
```{r}
Model_2<- lm(Weight ~PhysActive
             + Height
             + SleepHrsNight
             + AgeMonths
             + MaritalStatus
             + Education
             + Gender,
               data=nhanes_samp_adult_500)
tidy(Model_2)
```
-->

<!-- rewrite these solutions:
    -   Predictors: MaritalStatusSeparated;

    -   MaritalStatusWidowed;

    -   Education9 - 11th Grade;

    -   EducationCollege Grad;

    -   EducationHigh School;

    -   EducationSome College;

    -   SleepHrsNight;

    -   AgeMonths;

    -   maritalStatusLive Partner;

    -   maritalStatusNever Married;

    -   MaritalStatusMarried
-->

<!--
```{r}
Model_SlpHrNight<- lm(Weight ~PhysActive
             + Height
            # + SleepHrsNight
             + AgeMonths
             + MaritalStatus
             + Education
             + Gender,
               data=nhanes_samp_adult_500)
tidy(Model_SlpHrNight)
```


```{r}
Model_Education<- lm(Weight ~PhysActive
             + Height
          #  + SleepHrsNight
             + AgeMonths
             + MaritalStatus
          #  + Education
             + Gender,
               data=nhanes_samp_adult_500)
tidy(Model_Education)
```

```{r}
Model_Age <- lm(Weight ~PhysActive
             + Height
          #  + SleepHrsNight
          #  + AgeMonths
             + MaritalStatus
          #  + Education
             + Gender,
               data=nhanes_samp_adult_500)
tidy(Model_Age)

```

```{r}
Model_Marital <- lm(Weight ~PhysActive
             + Height
          #  + SleepHrsNight
          #  + AgeMonths
          #  + MaritalStatus
          #  + Education
             + Gender,
               data=nhanes_samp_adult_500)
tidy(Model_Marital)
```

```{r}
Model_2_done <- lm(Weight ~PhysActive
             + Height,
               data=nhanes_samp_adult_500)
tidy(Model_2_done)
```
-->

b)  What is the R-squared value of the model in part (a) above? Interpret the value in the context of the data.

c) Perform model selection (backward elimination) to come up with the ''best model'' for predicting weight. Write down the equation of the model. You do not need to show all the steps of the backward elimination process but you should explain these steps here in brief.

d) Interpret the intercept and all slopes in the final model from part (c). 

<!--
    -   Intercept: No practical meaning for the intercept.

    -   PhysActiveYes: On average, physically active individuals of the same height weigh 6.25 Kg less than their counterparts that are not physically active.
-->
e)  Examine the first case in the data set. Does your model underestimate or overestimate the weight of the individual? By how much?

<!--
$$
    \widehat{Weight}=-60.53-6.35(0)+0.87(172.2)\\
    =89.28 Kgs\\
    Residual = 82.2-89.28=-7.82
$$
-->


## Problem 2 (Logistic Regression)

Many studies show that being overweight increases one's risk of heart disease, stroke, type 2 diabetes, and other conditions. A common measure for determining whether someone is overweight is the Body Mass Index (BMI). BMI is a measure that accounts for both weight and height of an individual and is computed as follows:

$$BMI=\frac{Weight}{(Height)^2}$$

Where `weight` is measured in **Kilograms** and `Height` is measured in **meters**.

In this problem, you will use the same data set used in problem 1 to run a model for the likelihood of diabetes based on `BMI`, `Age`, and `Gender`. Note that the variable `Diabetes` is categorical with levels **Yes** and **No**.

a)  Create a regression model (name it `Diabetes_Model`) for predicting whether someone has diabetes or not based on their BMI, Age, and Gender. (Note: You may have to first mutate the Diabetes variable to use 1's and 0's. Check out the labs.
<!--
```{r}
nhanes_samp_adult_500<- nhanes_samp_adult_500%>% 
  mutate(Diabetes_New = ifelse(Diabetes=="Yes", 1, 0) )
```

```{r}
Diabetes_Model<- glm(Diabetes_New~BMI+Age+Gender, family=binomial, data =nhanes_samp_adult_500)
tidy(Diabetes_Model)
```
-->
b)  Write down the equation of the model and interpret the coefficient for `Gender` and `BMI`.
<!--
$$
ln\left(\frac{p_i}{1-p_i}\right)=-8.995 + 0.1127 (BMI) +0.0607 (Age) +0.01724 (GenderMale)
$$

-   Gender: On average, the log odds of having diabetes is higher by 0.01724 for males than for females when you control for BMI and Age.

-   BMI: On average, for every additional BMI unit, the log odds of having diabetes increases by 0.1127 all else held constant.
-->
c)  James (male) is 57 years old, weighs 87.9 Kg, and is 156 cm tall. How would the `Diabetes_Model` classify this individual (Diabetes or No diabetes)?
<!--
-   First, we compute James' BMI using the equation given above:

$$ JamesBMI =\frac{87.9}{1.56^2} = 36.12 $$

-   Next, we insert the variable values for James into the logistic model equation:

$$
ln\left(\frac{p_i}{1-p_i}\right)= -8.995 + 0.1127 (36.12) +0.0607 (57) + 0.01724 (1)= -1.45
$$

-   Finally, convert the log odds above to a probability:

$$
p_{James}=\frac{e^{-1.45}}{1+e^{-1.45}}=0.19
$$ - Since the probability is less than 0.5, the model will classify James as **Non-diabetic**.
-->
d)  Create a confusion matrix to determine the accuracy of the `Diabetes_Model`.
<!--
```{r}
Aug_Diabetes_Model<- augment(Diabetes_Model, type.predict = "response")

```

Create the augmented model now:

```{r}
Aug_Diabetes_ModelPlus <- Aug_Diabetes_Model %>%
  mutate(diabetes_hat = round(.fitted))
```

Create confusion matrix:

```{r}
Aug_Diabetes_ModelPlus %>%
  select(Diabetes_New,diabetes_hat )%>%
  table()

```

-   The total is 497 (all 0's and 1's). $Accuracy = \frac{437+6}{437+4+50+6}=89.13\%$.
-->
